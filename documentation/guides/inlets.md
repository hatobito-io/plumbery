# Inlets, unwrapping and context
<!-- vim: set tw=80 : -->

## Inlets

Building a request to be passed to a pipeline can be verbose, especially when
you just need to pass in a couple of arguments in the command field. Plumbery
provides a helper that makes things easier, called *inlet*. An inlet is a
generated function that stuffs arguments into a request's `command` struct/map
and calls a pipeline.

Let's see how inlets work. If you read through other guides, you may have
already noticed that we use examples that do not look like something one would
realistically write but hopefully explain concepts well. I will not break this
pattern and create a pipeline that does something that does not require a
pipeline.

!elixir examples/inlets_1.exs

Looks like that's too much effort to just pass in a couple of numbers. Let's
create and use an inlet.

!elixir examples/inlets_2.exs

Here we can see some interesting things about an inlet:

* you can define the exact signature of the inlet function, including patterns,
  default values and guard clauses
* the arguments are added to request's command, under the same names as the
  arguments


> #### Info {: .info}
>
> In some cases when using named arguments and patterns it is not possible to
> distinguish variable name from the pattern (like in `y = x` above). In that
> case the lefthand side is used as variable name and the key to put inside the
> command map.

## Unwrapping

Passing the whole request structure from pipe to pipe is necessary since we need
to keep track of the pipeline state, but for a pipeline that is not meant to be
included in other pipelines all we are interested in is the execution result,
not command, assigns and other stuff inside the request struct. We can make a
pipeline to return only the result using the `unwrap` option.


!elixir examples/inlets_3.exs

Inlets can be also defined outside of a pipeline, in that case you need to
specify the pipeline to execute:

!elixir examples/inlets_4.exs

## Context

Oftentimes when building APIs it is common that most entrypoints require a
context argument with current user and other information. For that purpose
`Plumbery.Request` has `context` field, but other than that Plumbery does not
provide support for context. The only exception is the ability to add `context`
as the last argument for functions generated by inlets. If you specify
`use_context` option, the `context` will be added as the last argument of the
generated function.

!elixir examples/inlets_5.exs

